<html>
  <head>
	<title>Netplay quality checker</title>
	<style>
	  .canvas_div {
		  float:right;
	  }
	  .popup {
		  display:none;
	  }
	</style>
  </head>
  <body>
	<h1>Netplay quality checker</h1>
	<div id="help">
	  <p>This tool allows a user to check the quality of his network connection for the purpose of playing fighting games. The tool simulates a simple "game" where two players, represented by lines, move backward and forward. Since the game's movement rely on faked keyboard strokes instead of acutal ones, it is completely predictable. Thus, the tool is capable of running an ideal version of the game, knowing exactly how players will both. Two copies of the game are ran: the upper copy uses rollback netcode in order to synchronize the two players in real-time, while the bottom copy represents an ideal game where there is no network lag. You can use this tool to see the artifacts caused by network lag and how they are countered by rollback and delay parameters. Note that except for the faulty connection simulation parameters, all other parameters are automatically enforced on both sides of the connection.</p>

	  <p>I hope you find this tool useful, whether to evaluate the best parameters for your netplay, or to learn how netcode works. This tool was created through modification of Thomas Boyt's telegraph library, which is itself a Javascript port of GGPO, one of the first rollback netcode implementations for fighting games. The code for telegraph can be found <a href="https://github.com/thomasboyt/telegraph">here</a>. My modifications can be found <a href="https://github.com/lucasnate/telegraph">here</a>.</p>

	  <p>Also, I made this as a preparation for creating a browser based fighting game, wish me luck.</p>

	  <button id="hide_help">Click to continue</button>
	</div>
	<div id="main">
	  <button id="show_help">Click here for help</button>
	  <div id="online_stuff">
		<div class="canvas_div">
		  <canvas id="actual_canvas" width="0" height="0"></canvas>
		  <br/>
		  <canvas id="ideal_canvas" width="0" height="0"></canvas>
		  <br/>
		</div>
		<div>
		  <h2>Network connection parameters for both machines</h2>
		  <label for="delay">Delay frames (press z):</label>
		  <input type="range" id="delay" min="0" max="20" value="0"/>
		  <output>0</output>
		  <button class="popup_button">?</button>
		  <span class="popup">The delay parameter tells the netcode to add an artifical delay to your key presses, this delay gives time for the other side to catch up with your key presses. Whenever you want, you can press Z to change the shape of one of the lines. The higher the delay, the longer will it take for the line to start changing.</span>
		  <br/>
		  <label for="rollback">Rollback frames:</label>
		  <input type="range" id="rollback" min="2" max="20" value="2"/>
		  <output>2</output>
		  <button class="popup_button">?</button>
		  <span class="popup">The rollback parameter tells the netcode how many game frames to predict when not receiving input from the other player. Rollback artifacts can be seen when the moving lines "break". Since rollback attempts to predict where the lines will move, then network lag will cause prediction failures whenever the lines change direction/speed.</span>
		  <br/>
		  <button id="reset">Reset connection</button>
		</div>
		<div>
		  <h2>Simulation parameters for both machines</h2>
		  <label for="key_interval">Direction change interval (in frames)</label>
		  <input type="range" id="key_interval" min="2" max="60" value="16" step="2"/>
		  <output>16</output>
		  <button class="popup_button">?</button>
		  <span class="popup">The direction change interval tells the automated players how quickly to change directions. The lower it is, the faster will the players alternate between moving left or right.</span>
		  <br/>
		  <label for="distance">Movement distance (in pixels)</label>
		  <input type="range" id="distance" min="20" max="250" value="20" step="1"/>
		  <output>20</output>
		  <button class="popup_button">?</button>
		  <span class="popup">The movement distance parameter tells the automated players how far to move.</span>
		  <br/>
		  <label for="move_type">Movement type</label>
		  <select id="move_type">
			<option value="dash">Dash</option>
			<option value="walk">Walk</option>
		  </select>
		  <button class="popup_button">?</button>
		  <span class="popup">The movement type tells the player to use one of two types of movement: walk or dash. A walk movement has constant speed and can change direction immediately. A dash movement is more realistic, representing an object with acceleration that needs to spend effort to stop. Note that when using the dash movement, it will not always be possible to accurately select the requested movement distance.</span>
		</div>
		<div id="fauly_connection">
		  <h2>Faulty connection simulation (use if running both on your machine)</h2>
		  <label for="min_fake_lag">Minimal fake lag (ms):</label>
		  <input type="range" id="min_fake_lag" min="0" max="1000" value="0"/>
		  <output>0</output>
		  <button class="popup_button">?</button>
		  <span class="popup">For each sent packet, it will be delayed by at least this value</span>
		  <br/>
		  <label for="max_fake_lag">Maximal fake lag (ms):</label>
		  <input type="range" id="max_fake_lag" min="0" max="1000" value="0"/>
		  <output>0</output>
		  <button class="popup_button">?</button>
		  <span class="popup">For each sent packet, it will be delayed by at most this value</span>
		  <br/>
		  <label for="fake_packet_loss">Packet loss (percents):</label>
		  <input type="range" id="fake_packet_loss" min="0" max="100" value="0"/>
		  <output>0</output>
		  <button class="popup_button">?</button>
		  <span class="popup">Percentage of sent packets to drop</span>
		</div>
	  </div>
	  <div id="offline_stuff">
		<div id="server_prompt">
		  <p>
			To run a netplay quality test against a friend, <button id="copy">copy</button> the connection URL to your friend. You can also  <button id="open">open</button> a second instance on an another tab and use the faulty connection simulation.
		  </p>
		  <p>
			Connection URL is: <span id="url_for_friend"></span>
		  </p>
		</div>
		<p id="client_prompt">
		  Connecting...
		</p>
	  </div>
	</div>
  </body>
</html>
